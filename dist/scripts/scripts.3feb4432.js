"use strict";angular.module("datacityApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/data.html",controller:"MainCtrl",controllerAs:"main"}).when("/city",{templateUrl:"views/city.html",controller:"CityCtrl",controllerAs:"city"}).when("/data",{templateUrl:"views/data.html",controller:"MainCtrl",controllerAs:"main"}).when("/views",{templateUrl:"views/views.html",controller:"ViewsCtrl",controllerAs:"views"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl",controllerAs:"admin"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).otherwise({redirectTo:"/data"})}]);var App=angular.module("datacityApp");App.controller("MainCtrl",["$scope","$http","$rootScope","$log",function(a,b,c,d){$(".nav a").on("click",function(){$(".nav").find(".active").removeClass("active"),$(this).parent().addClass("active")}),a.selectRow=function(a){return a==c.dataset?success:success},null==c.username&&(c.username="Kalle Ölsand"),a.login=function(a){c.username=a},a.chosenCollection=null,a.setChosenCollection=function(b){d.info("ID: "+b),a.chosenCollection===a.collections[b]?a.chosenCollection=null:(d.info(a.collections),a.chosenCollection=a.collections[b]),d.info(a.chosenCollection)},a.deleteDataset=function(b){delete a.data[b],c.chosenDataset==b&&(c.chosenDataset=null)},a.dataView={showUploadForm:!1},a.viewView={setChosenView:function(b){a.chosenView==b?a.chosenView=null:a.chosenView=b}},a.numberOfViews=function(){var b=Object.keys(a.views).length;return b},a.createNewView=function(b){var d=a.numberOfViews()+1,e=new Date;a.views[d]={id:d,name:"Neue Ansicht",collectionID:c.chosenDataset,creator:c.username,createdAt:e.toLocaleDateString()},"undefined"!=typeof b&&a.viewView.setChosenView(d)},a.deleteView=function(b){delete a.views[b],a.chosenView==b&&(a.chosenView=null)},a.chosenCollection=null,a.chosenView=null;var e={1:{id:1,name:"GebRate1",collectionID:1,creator:"Steffen Statistiker",createdAt:"26.11.2015 17:25 Uhr",dimensions:{name:"",area:"",height:"",color:""}},2:{id:2,name:"Logfile vom 24.12.2015",collectionID:2,creator:"Benedikt Rumtreiber",createdAt:"30.11.2015 16:40 Uhr",dimensions:{name:{attr:null},area:{attr:null},height:{attr:null}}},3:{id:3,name:"Export vom 1.1.1994",collectionID:3,creator:"Benedikt Rumtreiber",createdAt:"30.11.2015 16:41 Uhr",dimensions:{name:{attr:null},area:{attr:null},height:{attr:null}}}};a.views=e,a.data=null;var f="prelife",g="a",h="a";getCollections(f,g,h,b,function(b){d.info(b),a.collections=b,a.numberOfCollections=Object.keys(b).length}),a.formatTimeString=function(a){var b=new Date(a);return b.toLocaleDateString()+" "+b.toLocaleTimeString()}}]),angular.module("datacityApp").directive("choosedatasource",function(){return{template:'<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Datenquelle wählen</h3></div><div class="panel-body"><form name="dataSourceForm"><label><input type="radio" ng-model="dataSource" value="existingCollection">Bestehenden Datensatz verwenden</label><br/><label><input type="radio" ng-model="dataSource" value="existingView">Bestehende Ansicht verwenden</label><br/><label><input type="radio" ng-model="dataSource" value="uploadCSVFile">CSV-Datei hochladen</label><br/><chooseexistingmongodbcollection ng-show="dataSource == \'existingCollection\'"></chooseexistingmongodbcollection><uploadformdatasourcefile ng-show="dataSource == \'uploadCSVFile\'"></uploadformdatasourcefile><chooseexistingview ng-show="dataSource == \'existingView\'"></chooseexistingview></div></div>',restrict:"E",link:function(a,b,c){}}}),angular.module("datacityApp").directive("uploadformdatasourcefile",function(){return{template:'<div class="container"><h3>Eine .csv-Datei hochladen:</h3><input name="Datei" type="file" size="50" accept="csv/*"><button type="button" class="btn btn-default" onclick="">Datei hochladen</button></div>',restrict:"E"}}),angular.module("datacityApp").directive("chooseexistingmongodbcollection",function(){return{template:'<div class ="container"><h3>Einen Datensatz auswählen:</h3><div class="btn-group"> <!--  ng-repeat="sets in datasets" --><button type="button" class="btn btn-default btn-sm">Datensatz 1</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><div class="btn-group"><button type="button" class="btn btn-default btn-sm">Datensatz 2</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><div class="btn-group"><button type="button" class="btn btn-default btn-sm">...</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><!--[Nach Auswahl eines Datensatzes werden die Parameter und Ansichten aktualisiert; Sicherheitsabfrage beim Löschen]--></div>',restrict:"E",link:function(a,b,c){}}}),angular.module("datacityApp").directive("displaydatasettings",function(){return{template:"<div></div>",restrict:"E",link:function(a,b,c){b.text("this is the displaydatasettings directive")}}}),angular.module("datacityApp").controller("ViewsCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("datacityApp").controller("CityCtrl",["$http","$scope","$log",function(a,b,c){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.json=null,b.loadCollections=function(){getCollections("prelife","a","a",a,function(a){b.json=a,c.info(a)})}}]),angular.module("datacityApp").directive("hbar",function(){return{template:'<hr style="width: 100%; color: black; height: 1px; background-color:black;" />',restrict:"E",link:function(a,b,c){}}}),angular.module("datacityApp").directive("chooseexistingview",function(){return{template:'<div class ="container"><h3>Eine Ansicht auswählen:</h3><div class="btn-group"> <!--  ng-repeat="view in views" --><button type="button" class="btn btn-default btn-sm">Ansicht 1</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><div class="btn-group"><button type="button" class="btn btn-default btn-sm">Ansicht 2</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><div class="btn-group"><button type="button" class="btn btn-default btn-sm">...</button><button class="btn btn-danger btn-sm" ng-click="removeTodo($index)" aria-label="Remove">X</button></div><!--[Nach Auswahl eines Datensatzes werden die Parameter aktualisiert; Sicherheitsabfrage beim Löschen]--></div>',restrict:"E",link:function(a,b,c){}}}),angular.module("datacityApp").controller("AdminCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("datacityApp").controller("LoginCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("datacityApp").directive("tableofviews",function(){return{template:"<div></div>",restrict:"E",link:function(a,b,c){b.text("this is the tableofviews directive")}}});var test=function(a,b){return a+b},BASEURL="https://pegenau.com:16392",getCollections=function(a,b,c,d,e){setAuthHeader(b,c,d),d.get(BASEURL+"/"+a).then(function(a){e(a.data._embedded["rh:coll"])})},getViews=function(a,b,c,d,e,f){setAuthHeader(c,d,e),e.get(BASEURL+"/"+a+"/"+b).then(function(a){f(a)})},getNumberOfCollections=function(a,b,c,d,e){getCollections(a,b,c,d,function(a){var b=Object.keys(a).length;e(b)})},getNumberOfViews=function(a,b,c,d,e,f){getViews(a,b,c,d,e,function(a){var b=Object.keys(a).length;f(b)})},setAuthHeader=function(a,b,c){c.defaults.headers.common.Authorization="Basic "+btoa(a+":"+b)};angular.module("datacityApp").run(["$templateCache",function(a){a.put("views/admin.html","<p>This is the admin view.</p>"),a.put("views/city.html",'<div id="Stadt"> <h1 ng-click="loadCollections();">Hier könnte ihre Stadt stehen!</h1> {{json}} </div>'),a.put("views/data.html",'<div ng-app="datacityApp" ng-controller="MainCtrl"> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title">Datensätze</h3> </div> <div class="panel-body"> <table class="table"> <tr> <th>Name</th> <th>Erstellt</th> <th>Geändert</th> <th></th> </tr> <tr ng-repeat="collection in collections" ng-click="setChosenCollection(collection._id)"> <td>{{collection._id}}</td> <td>{{formatTimeString(collection._created_on)}}</td> <td>{{formatTimeString(collection._lastupdated_on)}}</td> <td><span class="glyphicon glyphicon-trash" aria-hidden="true" ng-click="deleteDataset(collection.id)"></span></td> </tr> </table> <div ng-show="chosenCollection" class="well"> {{chosenCollection._id}} </div> <button type="button" class="btn btn-default pull-right" ng-click="dataView.showUploadForm = !dataView.showUploadForm"> <span class="glyphicon glyphicon-upload" aria-hidden="true"></span> CSV-Datei hochladen </button> <div class="pull-left"> Legende: <br> <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Löschen <br> <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Ansichten verwalten <br> </div> </div> </div> <div class="panel panel-default" ng-show="dataView.showUploadForm"> <div class="panel-heading"> <h3 class="panel-title">Datensatz hochladen</h3> </div> <div class="panel-body"> <uploadformdatasourcefile></uploadformdatasourcefile> </div> </div></div>'),a.put("views/login.html",'<div ng-app="datacityApp" ng-controller="MainCtrl"> <form role="form"> <div class="form-group"> <label for="email">Username:</label> <input type="text" class="form-control" ng-model="usernameInput"> </div> <div class="form-group"> <label for="pwd">Password: [noch keine Funktion]</label> <input type="password" class="form-control"> </div> <button type="submit" class="btn btn-default" ng-click="login(usernameInput)">Einloggen</button> </form> </div>'),a.put("views/main.html",'<choosedatasource></choosedatasource> <hr style="width: 100%; color: black; height: 1px; background-color:black"> <div class="container"> <button type="button" class="btn btn-default" onclick="ausgabe()">Ausgabe anzeigen</button> </div> <div class="container"> <h3>Ausgabe:</h3> <p id="ausgabe"></p> </div>'),a.put("views/views.html",'<div ng-app="datacityApp" ng-controller="MainCtrl"> <h3>Ausgewählter Datensatz: <u>{{data[chosenDataset].name}}</u></h3> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title">Ansichten</h3> </div> <div class="panel-body"> <table class="table"> <tr> <th>Name</th> <th>Datensatz</th> <th>Erstellt von</th> <th>Erstellt am</th> </tr> <!-- <tr ng-repeat="view in views | filterBy:\'creator\'" ng-click="viewView.setChosenView(view.id);"> Funktionert nicht--> <!-- <tr ng-repeat="view in views | filterBy: \'Benedikt Rumtreiber\'" ng-click="viewView.setChosenView(view.id);"> Selbst das nicht--> <tr ng-repeat="view in views" ng-click="viewView.setChosenView(view.id);"> <td>{{view.name}}</td> <td>{{data[view.collectionID].name}}</td> <td>{{view.creator}}</td> <td>{{view.createdAt}}</td> </tr> <tr ng-hide="numberOfViews() > 0"> <td colspan="4" align="center">Keine Ansichten vorhanden!</td> </tr> </table> </div> <button type="button" class="btn btn-default pull-right" ng-click="createNewView(true);"> <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Neue Ansicht erstellen </button> </div> <br> <div class="panel panel-default" ng-show="chosenView"> <div class="panel-heading"> Ansicht bearbeiten: {{views[chosenView].name}} <div class="btn-group btn-group-xs pull-right" role="group" aria-label="..."> <button type="button" class="btn btn-default" ng-click="deleteView(chosenView);"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button> <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span></button> <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span></button> <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button> </div> </div> <div class="panel-body"> <div class="input-group"> <span class="input-group-addon">Name</span> <input type="text" class="form-control" placeholder="{{views[chosenView].name}}" ng-model="views[chosenView].name"> </div> <br> <!-- Wird nicht mehr benötigt, wenn man nur einen Datensatz betrachtet\n			<div class="input-group">\n				<span class="input-group-addon">Datensatz</span>\n				<select class="form-control" ng-model="views[chosenView].collectionID" ng-options="collection.id as collection.name for collection in data">\n				</select>\n			</div>\n			<br />\n			--> <div ng-show="views[chosenView].collectionID"> <h4>Dimensionen festlegen</h4> <div class="input-group"> <span class="input-group-addon">Name</span> <select class="form-control" ng-model="views[chosenView].dimensions.name.attr" ng-options="attr.id as attr.name for attr in data[views[chosenView].collectionID].attributes"> </select> </div> <br> <div class="input-group"> <span class="input-group-addon">Fläche</span> <select class="form-control" ng-model="views[chosenView].dimensions.area.attr" ng-options="attr.id as attr.name for attr in data[views[chosenView].collectionID].attributes"> </select> </div> <br> <div class="input-group"> <span class="input-group-addon">Höhe</span> <select class="form-control" ng-model="views[chosenView].dimensions.height.attr" ng-options="attr.id as attr.name for attr in data[views[chosenView].collectionID].attributes" ng-change="views[chosenView].dimensions.height.attr = value"> </select> </div> <br> <!-- Kann noch nicht visualisiert werden\n				<div class="input-group">\n					<span class="input-group-addon">Farbe</span>\n					<select class="form-control" ng-model="views[chosenView].dimensions.color.attr" ng-options="attr.id as attr.name for attr in data[views[chosenView].collectionID].attributes">\n					</select>\n				</div>\n				<br />\n				--> </div> </div> </div> <h3>Test {{views[chosenView].dimensions.name.attr}}</h3> <div class="container" ng-repeat="set in data"> <div class="col-sm-4"> <label>{{set.name}}</label> <select class="form-control"> <option ng-repeat="collection in set.attributes">{{collection.name}} - {{collection.type}}</option> </select> </div> </div> ----------- Hier wird der Datensatz "Geburtenrate in Hessen" benutzt ----------------- <div class="container"> <div class="col-sm-4"> <label for="sel1">Name:</label> <select class="form-control" id="name"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> </div> <div class="container"> <div class="col-sm-4"> <label for="sel1">Flächeninhalt:</label> <select class="form-control" id="area"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> </div> <div class="container"> <div class="col-sm-4"> <label for="sel1">Höhe:</label> <select class="form-control" id="height"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> </div> <h3>Ab hier muss alles in späteren Instanzen eingefügt werden!</h3> <div class="container"> <div class="col-sm-4"> <label for="sel1">Farbe:</label> <select class="form-control" id="farbeselektieren"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> <div class="col-sm-4"> <br> <br> <label class="radio-inline"> <input type="radio" name="farbenRadio" id="farbenRadio1" checked>Aufsteigend</label> <label class="radio-inline"> <input type="radio" name="farbenRadio" id="farbenRadio2">Absteigend</label> </div> </div> <br> <br> <div class="container"> <div class="col-sm-4"> <label for="sel1">Gruppierungen:</label> <select class="form-control" id="gruppierung"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> <div class="col-sm-8"> <br>[Hier muss noch nach Abfrage des Typs bei Integer ein Eingabefeld hin] </div> </div> <div class="container"> <div class="col-sm-4"> <label for="sel1">Verbindungen:</label> <select class="form-control" id="verbindung"> <option ng-repeat="collection in data[1].attributes">{{collection.name}}</option> </select> </div> <div class="col-sm-8"> <br>[Es ist noch unklar, wie genau der Input bei den Verbindungen dargestellt wird] </div> </div> <div class="container"> <div class="col-sm-4"> <label>Winkel einstellen:</label> <div id="slider"> <input class="bar" type="range" min="0" max="360" step="1" id="winkelInput" value="0" onchange="winkelOutput.value=value.concat(\'°\')"> <output id="winkelOutput">0°</output> </div> </div> </div> <div class="container"> <div class="col-sm-4"> <label>Granularität einstellen:</label> <div id="slider"> <input class="bar" type="range" min="0" max="100" step="1" id="granularInput" value="0" onchange="granularOutput.value=value.concat(\'%\')"> <output id="granularOutput">0%</output> </div> </div> </div> </div> <div class="container"> <button type="button" class="btn btn-default" onclick="ausgabe()">Ausgabe anzeigen</button> </div> <div class="container"> <h3>Ausgabe:</h3> <p id="ausgabe"></p> </div> ')}]);